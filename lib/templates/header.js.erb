<script type="text/javascript">
  window.analytics||(window.analytics=[]),window.analytics.methods=["initialize","identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;window.analytics.methods.length>i;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)};(function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="<%= opts.analytics_url %>";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)})();
  
  window._aopts = {
    'providers': {
      'All': false,
      'Intercom': <%= !opts.user_id.nil? %>,
      'Google Analytics': true,
      'Mixpanel': true,
      'HubSpot': true,
      'Olark': <%= !opts.include_olark?.nil? %>
    }
  };
  <%- if opts.intercom_secret -%>
  _aopts.Intercom = {userHash: "<%= OpenSSL::HMAC.hexdigest("sha256", opts.intercom_secret.to_json, opts.user_id.to_json) %>"};
  <%- end -%>
  analytics.load();
  <%- if opts.include_olark? -%>
  analytics.initialize({'Olark': {siteId: '7808-547-10-4236'}});
  <%- end -%>
  analytics.page(_aopts);
  <%= identify(opts.user_id, opts.user_payload) if opts.user_id && opts.user_payload %>
</script>